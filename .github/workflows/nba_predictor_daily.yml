name: Daily NBA Predictor (Local Runner)

on:
    workflow_dispatch:
        inputs:
            date:
                description: "Prediction date: YYYY-MM-DD, today, tomorrow (leave empty for default: today)"
                required: false
    #             default: ""
    # schedule:
    #     # Madrid (CET, UTC+1): 18, 20, 21, 22, 23, 24 -> UTC: 17, 19, 20, 21, 22, 23
    #     - cron: "01 19 * * *"
    #     - cron: "01 20 * * *"
    #     - cron: "01 21 * * *"
    #     - cron: "01 22 * * *"
    #     - cron: "01 23 * * *"

concurrency:
    group: daily-nba-predictor
    cancel-in-progress: true

permissions:
    contents: read

jobs:
    run:
        runs-on: self-hosted
        env:
            PYTHONWARNINGS: "ignore::UserWarning,ignore::DeprecationWarning,ignore::FutureWarning"

            # Critical for resolving imports that live under src/
            PYTHONPATH: ${{ github.workspace }}/src

            DB_ENV: supabase
            SUPABASE_DB_URL: ${{ secrets.SUPABASE_DB_URL }}
            SUPABASE_DB_PASSWORD: ${{ secrets.SUPABASE_DB_PASSWORD }}
            ODDS_API_KEY: ${{ secrets.ODDS_API_KEY }}

            # Cron runs in UTC; keep runtime consistent
            TZ: UTC

        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                  python-version: "3.12"

            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install -r requirements.txt

            - name: Run NBA predictor
              run: python -m src.nba_predictor
