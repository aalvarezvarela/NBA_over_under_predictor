name: Daily NBA Predictor

on:
    workflow_dispatch:
        inputs:
            date:
                description: "Prediction date: YYYY-MM-DD, today, tomorrow (leave empty for default: today)"
                required: false
                default: ""
    schedule:
        # Madrid (CET, UTC+1): 18, 20, 21, 22, 23, 24 -> UTC: 17, 19, 20, 21, 22, 23
        - cron: "23 17 * * *"
        - cron: "23 19 * * *"
        - cron: "23 20 * * *"
        - cron: "23 21 * * *"
        - cron: "23 22 * * *"
        - cron: "23 23 * * *"

concurrency:
    group: daily-nba-predictor
    cancel-in-progress: true

permissions:
    contents: read

jobs:
    run:
        runs-on: ubuntu-latest
        env:
            PYTHONWARNINGS: "ignore::UserWarning,ignore::DeprecationWarning,ignore::FutureWarning"
            DB_ENV: supabase
            SUPABASE_DB_URL: ${{ secrets.SUPABASE_DB_URL }}
            SUPABASE_DB_PASSWORD: ${{ secrets.SUPABASE_DB_PASSWORD }}
            ODDS_API_KEY: ${{ secrets.ODDS_API_KEY }}
            TZ: UTC

        steps:
            - uses: actions/checkout@v4

            - uses: actions/setup-python@v5
              with:
                  python-version: "3.12"
                  cache: "pip"

            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install -r requirements.txt

            - name: Run NBA predictor
              run: python -m src.nba_predictor
